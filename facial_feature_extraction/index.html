<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facial Feature Extraction</title>
    <style>
        #canvas {
            border: 1px solid black;
        }
    </style>
</head>
<body>
    <input type="file" id="imageInput" accept="image/*">
    <canvas id="canvas"></canvas>
    <script src="https://cdn.jsdelivr.net/npm/face-api@0.22.2/dist/face-api.min.js"></script>
    <script>
        // Get input and canvas elements
        const imageInput = document.getElementById('imageInput');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // Load image and preprocess
        imageInput.addEventListener('change', async (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();

            reader.addEventListener('load', async () => {
                const imageData = reader.result;
                const img = new Image();

                img.addEventListener('load', async () => {
                    // Set canvas dimensions
                    canvas.width = img.width;
                    canvas.height = img.height;
                    // Draw image on canvas
                    ctx.drawImage(img, 0, 0);

                    // Detect facial features
                    const detections = await faceapi.detectAllFaces(img, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptors();

                    // Draw features on canvas
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    ctx.drawImage(img, 0, 0);
                    detections.forEach(detection => {
                        const landmarks = detection.landmarks;
                        const descriptor = detection.descriptor;
                        const box = detection.detection.box;

                        // Draw face box
                        ctx.beginPath();
                        ctx.rect(box.x, box.y, box.width, box.height);
                        ctx.strokeStyle = 'red';
                        ctx.stroke();

                        // Draw facial features
                        landmarks.forEach(landmark => {
                            ctx.beginPath();
                            ctx.arc(landmark.x, landmark.y, 2, 0, 2 * Math.PI);
                            ctx.fillStyle = 'red';
                            ctx.fill();
                        });
                    });
                });
                img.src = imageData;
            });

            reader.readAsDataURL(file);
        });
    </script>
</body>
</html>
